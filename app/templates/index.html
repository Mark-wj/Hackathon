<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ AI Job Matching Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(45deg, #fff, #e3f2fd);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 4px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .role-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }
        
        .ai-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            font-size: 0.8rem;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .auth-section {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card.ai-powered {
            border-left: 4px solid #4CAF50;
        }
        
        .stat-card.ai-powered::before {
            content: 'ü§ñ';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.2em;
            opacity: 0.7;
        }
        
        .stat-card h3 {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .number {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #fff, #e3f2fd);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-card .subtitle {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .tab-container {
            display: flex;
            gap: 4px;
            margin-bottom: 24px;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .tab {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: white;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(76, 175, 80, 0.3);
        }
        
        .btn-ai {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }
        
        .btn-ai:hover {
            box-shadow: 0 8px 24px rgba(33, 150, 243, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-logout {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }
        
        .btn-logout:hover {
            box-shadow: 0 8px 24px rgba(244, 67, 54, 0.3);
        }
        
        .job-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        
        .job-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }
        
        .job-card h4 {
            color: white;
            margin-bottom: 8px;
            font-size: 1.2rem;
        }
        
        .job-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin: 12px 0;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .match-score {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .skills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        
        .skill-tag {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .ai-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .ai-action-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        
        .ai-action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .ai-action-card .icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: block;
        }
        
        .ai-action-card h4 {
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .ai-action-card p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .message {
            padding: 16px 20px;
            margin: 16px 0;
            border-radius: 8px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .message.success {
            background: rgba(76, 175, 80, 0.1);
            color: #2e7d32;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .message.error {
            background: rgba(244, 67, 54, 0.1);
            color: #c62828;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        
        .message.info {
            background: rgba(33, 150, 243, 0.1);
            color: #1565c0;
            border: 1px solid rgba(33, 150, 243, 0.3);
        }
        
        .application-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending { background: #ff9800; color: white; }
        .status-reviewing { background: #2196F3; color: white; }
        .status-shortlisted { background: #4CAF50; color: white; }
        .status-rejected { background: #f44336; color: white; }
        .status-accepted { background: #4CAF50; color: white; }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 40px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }
        
        .close:hover {
            color: #333;
        }
        
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }
        
        .upload-area:hover {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.05);
        }
        
        .upload-area.dragover {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-container {
                flex-wrap: wrap;
            }
            
            .job-meta {
                flex-direction: column;
                gap: 8px;
            }
        }
        
        .hidden {
            display: none !important;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>ü§ñ AI Job Matching Platform</h1>
                <p>Find your perfect job match using artificial intelligence</p>
            </div>
            <div class="user-info" id="userInfo" style="display: none;">
                <div class="ai-status" id="aiStatus">
                    <div class="status-indicator"></div>
                    <span>AI Online</span>
                </div>
                <span class="role-badge">Job Seeker</span>
                <span id="userName">Loading...</span>
                <button class="btn btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Message Container -->
        <div id="message"></div>

        <!-- Login/Register Section -->
        <div id="authSection" class="glass-card auth-section">
            <div class="tab-container">
                <button class="tab active" onclick="showTab('login')">Login</button>
                <button class="tab" onclick="showTab('register')">Register</button>
            </div>

            <!-- Login Tab -->
            <div id="loginTab" class="tab-content active">
                <h2 style="margin-bottom: 24px; color: #333;">Welcome Back</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="loginEmail" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="loginPassword" required placeholder="Enter your password">
                    </div>
                    <button type="submit" class="btn">üöÄ Login</button>
                </form>
            </div>

            <!-- Register Tab -->
            <div id="registerTab" class="tab-content">
                <h2 style="margin-bottom: 24px; color: #333;">Create Account</h2>
                <form id="registerForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>First Name:</label>
                            <input type="text" id="firstName" required placeholder="Your first name">
                        </div>
                        <div class="form-group">
                            <label>Last Name:</label>
                            <input type="text" id="lastName" required placeholder="Your last name">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="registerEmail" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="registerPassword" required placeholder="Create a password">
                    </div>
                    <div class="form-group">
                        <label>I am a:</label>
                        <select id="userRole">
                            <option value="job_seeker">Job Seeker</option>
                            <option value="employer">Employer</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">üéØ Create Account</button>
                </form>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="appSection" style="display: none;">
            <!-- Dashboard Statistics -->
            <div class="dashboard-stats">
                <div class="stat-card ai-powered">
                    <h3>Profile Score</h3>
                    <div class="number" id="profileCompleteness">0%</div>
                    <div class="subtitle">AI Analysis</div>
                </div>
                <div class="stat-card">
                    <h3>Applications</h3>
                    <div class="number" id="applicationsCount">0</div>
                    <div class="subtitle">Total Sent</div>
                </div>
                <div class="stat-card ai-powered">
                    <h3>AI Matches</h3>
                    <div class="number" id="matchesCount">0</div>
                    <div class="subtitle">Found Today</div>
                </div>
                <div class="stat-card">
                    <h3>Interviews</h3>
                    <div class="number" id="interviewsCount">0</div>
                    <div class="subtitle">Scheduled</div>
                </div>
            </div>

            <!-- AI Quick Actions -->
            <div class="ai-actions">
                <div class="ai-action-card" onclick="findAIMatches()">
                    <span class="icon">üéØ</span>
                    <h4>Find AI Matches</h4>
                    <p>Let AI find perfect jobs for you</p>
                </div>
                <div class="ai-action-card" onclick="showAppTab('profile')">
                    <span class="icon">üìä</span>
                    <h4>Optimize Profile</h4>
                    <p>AI-powered profile analysis</p>
                </div>
                <div class="ai-action-card" onclick="showUploadModal()">
                    <span class="icon">üìÑ</span>
                    <h4>Smart Resume</h4>
                    <p>Upload & extract skills with AI</p>
                </div>
                <div class="ai-action-card" onclick="showAppTab('applications')">
                    <span class="icon">ü§ñ</span>
                    <h4>AI Cover Letters</h4>
                    <p>Generate personalized letters</p>
                </div>
            </div>

            <!-- Main Content Tabs -->
            <div class="glass-card">
                <div class="tab-container">
                    <button class="tab active" onclick="showAppTab('dashboard')">ü§ñ AI Dashboard</button>
                    <button class="tab" onclick="showAppTab('matches')">üéØ Smart Matches</button>
                    <button class="tab" onclick="showAppTab('jobs')">üíº Browse Jobs</button>
                    <button class="tab" onclick="showAppTab('applications')">üìã Applications</button>
                    <button class="tab" onclick="showAppTab('profile')">üë§ Profile</button>
                </div>

                <!-- AI Dashboard Tab -->
                <div id="dashboardTab" class="tab-content active">
                    <!-- This will be populated by the enhanced dashboard JavaScript -->
                </div>

                <!-- Smart Matches Tab -->
                <div id="matchesTab" class="tab-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="color: white;">üéØ AI-Powered Job Matches</h2>
                        <button class="btn btn-ai" onclick="findAIMatches()">
                            ü§ñ Find New Matches
                        </button>
                    </div>
                    <div id="matchesList">
                        <div class="loading">
                            <div class="spinner"></div>
                            <span>Loading AI matches...</span>
                        </div>
                    </div>
                </div>

                <!-- Browse Jobs Tab -->
                <div id="jobsTab" class="tab-content">
                    <h2 style="color: white; margin-bottom: 24px;">üíº Browse All Jobs</h2>
                    <div class="form-group">
                        <div style="display: flex; gap: 12px;">
                            <input type="text" id="searchQuery" placeholder="Search jobs by title, company, or keywords..." style="flex: 1;">
                            <button class="btn btn-ai" onclick="searchJobs()">üîç Search</button>
                        </div>
                    </div>
                    <div id="jobsList">
                        <div class="loading">
                            <div class="spinner"></div>
                            <span>Loading jobs...</span>
                        </div>
                    </div>
                </div>

                <!-- Applications Tab -->
                <div id="applicationsTab" class="tab-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="color: white;">üìã My Applications</h2>
                        <button class="btn btn-secondary" onclick="loadApplications()">üîÑ Refresh</button>
                    </div>
                    <div id="applicationsList">
                        <div class="loading">
                            <div class="spinner"></div>
                            <span>Loading applications...</span>
                        </div>
                    </div>
                </div>

                <!-- Profile Tab -->
                <div id="profileTab" class="tab-content">
                    <h2 style="color: white; margin-bottom: 24px;">üë§ My Profile</h2>
                    
                    <!-- AI Profile Analysis -->
                    <div style="background: rgba(33, 150, 243, 0.1); border: 1px solid rgba(33, 150, 243, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                        <h3 style="color: white; margin-bottom: 12px;">üß† AI Profile Analysis</h3>
                        <div id="profileAnalysis" style="color: rgba(255, 255, 255, 0.9);">
                            <div class="loading">
                                <div class="spinner"></div>
                                <span>Analyzing profile...</span>
                            </div>
                        </div>
                        <button class="btn btn-ai" onclick="analyzeProfile()" style="margin-top: 12px;">
                            üîç Re-analyze Profile
                        </button>
                    </div>

                    <!-- Profile Form -->
                    <form id="profileForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label style="color: white;">First Name:</label>
                                <input type="text" id="profileFirstName">
                            </div>
                            <div class="form-group">
                                <label style="color: white;">Last Name:</label>
                                <input type="text" id="profileLastName">
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label style="color: white;">Phone:</label>
                                <input type="tel" id="phone" placeholder="+254 700 000 000">
                            </div>
                            <div class="form-group">
                                <label style="color: white;">Location:</label>
                                <input type="text" id="location" placeholder="Nairobi, Kenya">
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="color: white;">Professional Summary:</label>
                            <textarea id="summary" rows="3" placeholder="Brief summary of your professional background..."></textarea>
                        </div>

                        <div class="form-group">
                            <label style="color: white;">Skills (comma separated):</label>
                            <input type="text" id="skills" placeholder="python, react, postgresql, machine learning">
                        </div>

                        <div class="form-group">
                            <label style="color: white;">Years of Experience:</label>
                            <input type="number" id="experienceYears" min="0" max="50">
                        </div>

                        <div class="form-group">
                            <label style="color: white;">Education:</label>
                            <textarea id="education" rows="3" placeholder="Bachelor of Computer Science - University of Nairobi (2020)"></textarea>
                        </div>

                        <div class="form-group">
                            <label style="color: white;">Work Experience:</label>
                            <textarea id="workExperience" rows="4" placeholder="Software Developer at TechCorp (2020-2023) - Developed web applications"></textarea>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label style="color: white;">LinkedIn URL:</label>
                                <input type="url" id="linkedinUrl" placeholder="https://linkedin.com/in/yourprofile">
                            </div>
                            <div class="form-group">
                                <label style="color: white;">GitHub URL:</label>
                                <input type="url" id="githubUrl" placeholder="https://github.com/yourusername">
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="color: white;">Portfolio URL:</label>
                            <input type="url" id="portfolioUrl" placeholder="https://yourportfolio.com">
                        </div>

                        <button type="submit" class="btn">üíæ Update Profile</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Resume Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUploadModal()">&times;</span>
            <h2>ü§ñ Smart Resume Analysis</h2>
            <p>Upload your resume and let AI extract your skills automatically!</p>
            
            <div class="upload-area" id="uploadArea">
                <div style="font-size: 3rem; margin-bottom: 16px;">üìÑ</div>
                <h3>Drop your resume here or click to browse</h3>
                <p>Supports PDF, DOC, DOCX files</p>
                <input type="file" id="resumeFile" accept=".pdf,.doc,.docx" style="display: none;">
            </div>
            
            <div id="uploadResult" style="margin-top: 20px;"></div>
            
            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn btn-ai" onclick="uploadResume()">üöÄ Analyze Resume</button>
                <button class="btn btn-secondary" onclick="closeUploadModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Include the enhanced dashboard JavaScript -->
    <script src="create_dashboard.js"></script>
    
    <script>
        const API_BASE = 'http://localhost:5000/api';
        let authToken = localStorage.getItem('authToken');
        let currentUser = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthAndLoadDashboard();
            setupEventListeners();
            setupUploadArea();
        });

        function setupEventListeners() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('profileForm').addEventListener('submit', handleProfileUpdate);
        }

        function setupUploadArea() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('resumeFile');

            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                }
            });
        }

        async function checkAuthAndLoadDashboard() {
            if (!authToken) {
                showAuthSection();
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.user;
                    
                    if (currentUser.role === 'employer') {
                        window.location.href = '/employer';
                        return;
                    } else if (currentUser.role === 'admin') {
                        window.location.href = '/admin';
                        return;
                    }
                    
                    showDashboard();
                    await loadAllData();
                } else {
                    logout();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                logout();
            }
        }

        function showAuthSection() {
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('appSection').style.display = 'none';
            document.getElementById('userInfo').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('appSection').style.display = 'block';
            document.getElementById('userInfo').style.display = 'flex';
            
            document.getElementById('userName').textContent = 
                `${currentUser.first_name || ''} ${currentUser.last_name || ''}`.trim() || currentUser.email;
            
            // Initialize AI dashboard
            if (typeof showDashboard === 'function') {
                showDashboard();
            }
        }

        async function loadAllData() {
            await Promise.all([
                loadDashboardStats(),
                loadProfile(),
                analyzeProfile(),
                checkAIStatus()
            ]);
        }

        async function loadDashboardStats() {
            try {
                const response = await fetch(`${API_BASE}/dashboard/stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const stats = data.stats || {};
                    
                    document.getElementById('applicationsCount').textContent = stats.applications || 0;
                    document.getElementById('interviewsCount').textContent = stats.interviews || 0;
                    document.getElementById('profileCompleteness').textContent = (stats.profile_completeness || 0) + '%';
                }
            } catch (error) {
                console.error('Stats loading error:', error);
            }
        }

        async function checkAIStatus() {
            try {
                const response = await fetch(`${API_BASE}/ai/model-status`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const status = await response.json();
                    const aiStatusEl = document.getElementById('aiStatus');
                    
                    const totalModels = Object.values(status).filter(s => s.loaded).length;
                    if (totalModels === 3) {
                        aiStatusEl.innerHTML = '<div class="status-indicator"></div><span>AI Online</span>';
                    } else {
                        aiStatusEl.innerHTML = '<div class="status-indicator" style="background: #ff9800;"></div><span>AI Limited</span>';
                    }
                }
            } catch (error) {
                console.error('AI status check failed:', error);
                document.getElementById('aiStatus').innerHTML = '<div class="status-indicator" style="background: #f44336;"></div><span>AI Offline</span>';
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem('authToken', data.access_token);
                    authToken = data.access_token;
                    currentUser = data.user;
                    
                    showMessage('Welcome back! üéâ', 'success');
                    
                    if (data.redirect_url && data.redirect_url !== '/') {
                        setTimeout(() => window.location.href = data.redirect_url, 1000);
                    } else {
                        setTimeout(() => {
                            showDashboard();
                            loadAllData();
                        }, 1000);
                    }
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage('Login failed. Please try again.', 'error');
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            
            const data = {
                email: document.getElementById('registerEmail').value,
                password: document.getElementById('registerPassword').value,
                first_name: document.getElementById('firstName').value,
                last_name: document.getElementById('lastName').value,
                role: document.getElementById('userRole').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    localStorage.setItem('authToken', result.access_token);
                    authToken = result.access_token;
                    currentUser = result.user;
                    
                    showMessage('Account created successfully! üéâ', 'success');
                    
                    if (result.redirect_url && result.redirect_url !== '/') {
                        setTimeout(() => window.location.href = result.redirect_url, 1000);
                    } else {
                        setTimeout(() => {
                            showDashboard();
                            loadAllData();
                        }, 1000);
                    }
                } else {
                    showMessage(result.error, 'error');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showMessage('Registration failed. Please try again.', 'error');
            }
        }

        async function findAIMatches() {
            showMessage('ü§ñ AI is finding your perfect matches...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/ai/match-jobs`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ min_match_score: 50 })
                });

                if (response.ok) {
                    const data = await response.json();
                    showMessage(`üéØ Found ${data.total_matches} AI-powered matches!`, 'success');
                    
                    document.getElementById('matchesCount').textContent = data.total_matches;
                    displayMatches(data.matches);
                    showAppTab('matches');
                } else {
                    const error = await response.json();
                    showMessage(`‚ùå ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('AI matching error:', error);
                showMessage('‚ùå Failed to find AI matches', 'error');
            }
        }

        function displayMatches(matches) {
            const matchesList = document.getElementById('matchesList');
            
            if (matches.length === 0) {
                matchesList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.8);">
                        <h3>No matches found yet</h3>
                        <p>Complete your profile to get better AI matches!</p>
                        <button class="btn btn-ai" onclick="showAppTab('profile')" style="margin-top: 16px;">
                            üìä Optimize Profile
                        </button>
                    </div>
                `;
                return;
            }
            
            matchesList.innerHTML = matches.map(match => `
                <div class="job-card fade-in">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <h4>${match.job.title}</h4>
                        <span class="match-score">üéØ ${match.scores.overall.toFixed(1)}% Match</span>
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;">
                        <strong>Company:</strong> ${match.job.company?.name || 'Company'}
                    </p>
                    <div class="job-meta">
                        <span>üìç ${match.job.location}</span>
                        <span>üíº ${match.job.job_type}</span>
                        <span>üìä ${match.job.experience_level}</span>
                        ${match.job.is_remote ? '<span>üè† Remote</span>' : ''}
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.8); margin: 12px 0;">
                        ${match.job.description?.substring(0, 150)}...
                    </p>
                    <div style="background: rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 12px; margin: 12px 0;">
                        <strong style="color: white;">Match Details:</strong><br>
                        <small style="color: rgba(255, 255, 255, 0.8);">
                            Skills: ${match.scores.skill_match.toFixed(1)}% | 
                            Experience: ${match.scores.experience_match.toFixed(1)}% | 
                            Location: ${match.scores.location_match.toFixed(1)}%
                        </small>
                    </div>
                    ${match.job.skills_required ? `
                        <div class="skills">
                            ${match.job.skills_required.slice(0, 5).map(skill => 
                                `<span class="skill-tag">${skill}</span>`
                            ).join('')}
                        </div>
                    ` : ''}
                    <div style="display: flex; gap: 12px; margin-top: 16px;">
                        <button class="btn btn-ai" onclick="applyToJobWithAI(${match.job.id})">
                            ü§ñ Apply with AI Cover Letter
                        </button>
                        <button class="btn btn-secondary" onclick="getInterviewPrep(${match.job.id})">
                            üìù Interview Prep
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function applyToJobWithAI(jobId) {
            if (!confirm('Generate an AI cover letter for this application?')) return;
            
            showMessage('ü§ñ Generating AI cover letter...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/applications/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        job_id: jobId,
                        generate_cover_letter: true
                    })
                });

                if (response.ok) {
                    showMessage('‚úÖ Application submitted with AI cover letter!', 'success');
                    loadDashboardStats();
                } else {
                    const error = await response.json();
                    showMessage(`‚ùå ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Application error:', error);
                showMessage('‚ùå Application failed', 'error');
            }
        }

        async function analyzeProfile() {
            try {
                const response = await fetch(`${API_BASE}/ai/analyze-profile`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const analysisDiv = document.getElementById('profileAnalysis');
                    
                    analysisDiv.innerHTML = `
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 16px; align-items: center;">
                            <div style="font-size: 3rem;">
                                ${data.profile_completeness >= 80 ? 'üèÜ' : 
                                  data.profile_completeness >= 60 ? 'üéØ' : 'üìà'}
                            </div>
                            <div>
                                <h4 style="margin-bottom: 8px;">Completeness: ${data.profile_completeness}%</h4>
                                ${data.suggestions.length > 0 ? `
                                    <div style="margin-top: 12px;">
                                        <strong>AI Suggestions:</strong>
                                        <ul style="margin-top: 8px; padding-left: 20px;">
                                            ${data.suggestions.map(s => `<li style="margin-bottom: 4px;">${s}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : '<p style="color: #4CAF50;">‚úÖ Your profile looks great!</p>'}
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('profileCompleteness').textContent = data.profile_completeness + '%';
                }
            } catch (error) {
                console.error('Profile analysis error:', error);
                document.getElementById('profileAnalysis').innerHTML = '<p style="color: #f44336;">‚ùå Failed to analyze profile</p>';
            }
        }

        async function loadProfile() {
            try {
                const response = await fetch(`${API_BASE}/users/profile`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Populate basic user info
                    document.getElementById('profileFirstName').value = data.first_name || '';
                    document.getElementById('profileLastName').value = data.last_name || '';
                    
                    if (data.profile) {
                        document.getElementById('phone').value = data.profile.phone || '';
                        document.getElementById('location').value = data.profile.location || '';
                        document.getElementById('summary').value = data.profile.summary || '';
                        document.getElementById('skills').value = data.profile.skills ? data.profile.skills.join(', ') : '';
                        document.getElementById('experienceYears').value = data.profile.experience_years || '';
                        document.getElementById('linkedinUrl').value = data.profile.linkedin_url || '';
                        document.getElementById('githubUrl').value = data.profile.github_url || '';
                        document.getElementById('portfolioUrl').value = data.profile.portfolio_url || '';
                        
                        // Handle JSON fields
                        if (data.profile.education && data.profile.education.items) {
                            document.getElementById('education').value = data.profile.education.items.join('\n');
                        }
                        
                        if (data.profile.work_experience && data.profile.work_experience.items) {
                            document.getElementById('workExperience').value = data.profile.work_experience.items.join('\n');
                        }
                    }
                }
            } catch (error) {
                console.error('Profile loading error:', error);
            }
        }

        async function handleProfileUpdate(event) {
            event.preventDefault();
            
            const skillsInput = document.getElementById('skills').value;
            const skills = skillsInput ? skillsInput.split(',').map(s => s.trim()).filter(s => s) : [];
            
            const educationText = document.getElementById('education').value;
            const education = educationText ? { items: educationText.split('\n').filter(line => line.trim()) } : null;
            
            const workExperienceText = document.getElementById('workExperience').value;
            const work_experience = workExperienceText ? { items: workExperienceText.split('\n').filter(line => line.trim()) } : null;
            
            const profileData = {
                first_name: document.getElementById('profileFirstName').value,
                last_name: document.getElementById('profileLastName').value,
                phone: document.getElementById('phone').value,
                location: document.getElementById('location').value,
                summary: document.getElementById('summary').value,
                skills: skills,
                experience_years: parseInt(document.getElementById('experienceYears').value) || 0,
                education: education,
                work_experience: work_experience,
                linkedin_url: document.getElementById('linkedinUrl').value,
                github_url: document.getElementById('githubUrl').value,
                portfolio_url: document.getElementById('portfolioUrl').value
            };

            try {
                const response = await fetch(`${API_BASE}/users/profile`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(profileData)
                });

                if (response.ok) {
                    showMessage('‚úÖ Profile updated successfully!', 'success');
                    await analyzeProfile();
                    loadDashboardStats();
                } else {
                    showMessage('‚ùå Failed to update profile', 'error');
                }
            } catch (error) {
                console.error('Profile update error:', error);
                showMessage('‚ùå Profile update failed', 'error');
            }
        }

        function showUploadModal() {
            document.getElementById('uploadModal').style.display = 'block';
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').style.display = 'none';
            document.getElementById('uploadResult').innerHTML = '';
        }

        async function uploadResume() {
            const fileInput = document.getElementById('resumeFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showMessage('‚ùå Please select a file', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            const resultDiv = document.getElementById('uploadResult');
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><span>ü§ñ AI is analyzing your resume...</span></div>';
            
            try {
                const response = await fetch(`${API_BASE}/ai/parse-resume`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div style="background: rgba(76, 175, 80, 0.1); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 8px; padding: 16px;">
                            <h4 style="color: #4CAF50; margin-bottom: 12px;">‚úÖ Resume Analyzed Successfully!</h4>
                            <p><strong>Skills found:</strong> ${result.skills.join(', ')}</p>
                            <p><strong>Summary:</strong> ${result.summary}</p>
                            ${result.contact ? `<p><strong>Contact:</strong> ${JSON.stringify(result.contact)}</p>` : ''}
                        </div>
                    `;
                    
                    showMessage('üéâ Resume analyzed! Skills extracted automatically.', 'success');
                    
                    // Auto-fill skills if found
                    if (result.skills && result.skills.length > 0) {
                        const currentSkills = document.getElementById('skills').value;
                        const newSkills = currentSkills ? currentSkills + ', ' + result.skills.join(', ') : result.skills.join(', ');
                        document.getElementById('skills').value = newSkills;
                    }
                    
                } else {
                    resultDiv.innerHTML = `<div style="color: #f44336;">‚ùå ${result.error}</div>`;
                    showMessage('‚ùå Failed to analyze resume', 'error');
                }
            } catch (error) {
                console.error('Resume upload error:', error);
                resultDiv.innerHTML = '<div style="color: #f44336;">‚ùå Upload failed</div>';
                showMessage('‚ùå Upload failed', 'error');
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('#authSection .tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('#authSection .tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function showAppTab(tabName) {
            document.querySelectorAll('#appSection .tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('#appSection .tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Load data for specific tabs
            if (tabName === 'matches') {
                loadMatches();
            } else if (tabName === 'jobs') {
                searchJobs();
            } else if (tabName === 'applications') {
                loadApplications();
            } else if (tabName === 'dashboard') {
                if (typeof showDashboard === 'function') {
                    showDashboard();
                }
            }
        }

        async function loadMatches() {
            const matchesList = document.getElementById('matchesList');
            matchesList.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading matches...</span></div>';
            
            try {
                const response = await fetch(`${API_BASE}/ai/match-history`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.matches && data.matches.length > 0) {
                        displayMatches(data.matches.map(m => ({ job: m.job, scores: { overall: m.match_score, skill_match: m.skill_match_score, experience_match: m.experience_match_score, location_match: m.location_match_score } })));
                    } else {
                        matchesList.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.8);">
                                <h3>No matches yet</h3>
                                <p>Click "Find AI Matches" to discover jobs perfect for you!</p>
                                <button class="btn btn-ai" onclick="findAIMatches()" style="margin-top: 16px;">
                                    üéØ Find AI Matches
                                </button>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Matches loading error:', error);
                matchesList.innerHTML = '<div style="color: #f44336; text-align: center; padding: 40px;">‚ùå Failed to load matches</div>';
            }
        }

        async function searchJobs() {
            const query = document.getElementById('searchQuery').value || '';
            const jobsList = document.getElementById('jobsList');
            
            jobsList.innerHTML = '<div class="loading"><div class="spinner"></div><span>Searching jobs...</span></div>';
            
            try {
                const response = await fetch(`${API_BASE}/jobs/search?q=${encodeURIComponent(query)}`);
                
                if (response.ok) {
                    const data = await response.json();
                    displayJobs(data.jobs || []);
                }
            } catch (error) {
                console.error('Job search error:', error);
                jobsList.innerHTML = '<div style="color: #f44336; text-align: center; padding: 40px;">‚ùå Failed to load jobs</div>';
            }
        }

        function displayJobs(jobs) {
            const jobsList = document.getElementById('jobsList');
            
            if (jobs.length === 0) {
                jobsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.8);">
                        <h3>No jobs found</h3>
                        <p>Try adjusting your search terms or browse all jobs.</p>
                    </div>
                `;
                return;
            }
            
            jobsList.innerHTML = jobs.map(job => `
                <div class="job-card fade-in">
                    <h4>${job.title}</h4>
                    <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;">
                        <strong>Company:</strong> ${job.company?.name || 'Company'}
                    </p>
                    <div class="job-meta">
                        <span>üìç ${job.location}</span>
                        <span>üíº ${job.job_type}</span>
                        <span>üìä ${job.experience_level}</span>
                        ${job.is_remote ? '<span>üè† Remote</span>' : ''}
                        ${job.salary_min && job.salary_max ? `<span>üí∞ ${job.salary_min.toLocaleString()} - ${job.salary_max.toLocaleString()}</span>` : ''}
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.8); margin: 12px 0;">
                        ${job.description?.substring(0, 200)}...
                    </p>
                    ${job.skills_required ? `
                        <div class="skills">
                            ${job.skills_required.slice(0, 5).map(skill => 
                                `<span class="skill-tag">${skill}</span>`
                            ).join('')}
                        </div>
                    ` : ''}
                    <div style="display: flex; gap: 12px; margin-top: 16px;">
                        <button class="btn btn-ai" onclick="applyToJobWithAI(${job.id})">
                            ü§ñ Apply with AI
                        </button>
                        <button class="btn btn-secondary" onclick="getMatchScore(${job.id})">
                            üéØ Check Match
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function getMatchScore(jobId) {
            try {
                const response = await fetch(`${API_BASE}/jobs/${jobId}/match`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    alert(`üéØ Match Score: ${data.scores.overall.toFixed(1)}%

üìä Breakdown:
‚Ä¢ Skills Match: ${data.scores.skill_match.toFixed(1)}%
‚Ä¢ Experience Match: ${data.scores.experience_match.toFixed(1)}%
‚Ä¢ Location Match: ${data.scores.location_match.toFixed(1)}%

${data.recommendation || ''}`);
                } else {
                    showMessage('‚ùå Failed to get match score', 'error');
                }
            } catch (error) {
                console.error('Match score error:', error);
                showMessage('‚ùå Failed to get match score', 'error');
            }
        }

        async function getInterviewPrep(jobId) {
            try {
                const response = await fetch(`${API_BASE}/ai/interview-prep/${jobId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    const prepContent = `üé§ Interview Preparation

üìã POTENTIAL QUESTIONS:
${data.questions.slice(0, 5).map((q, i) => `${i + 1}. ${q}`).join('\n')}

üí° PREPARATION TIPS:
${data.tips.slice(0, 3).map((t, i) => `${i + 1}. ${t}`).join('\n')}

üéØ KEY TOPICS TO REVIEW:
${data.key_topics ? data.key_topics.join(', ') : 'Technical skills, Experience, Company knowledge'}`;
                    
                    alert(prepContent);
                } else {
                    showMessage('‚ùå Failed to get interview prep', 'error');
                }
            } catch (error) {
                console.error('Interview prep error:', error);
                showMessage('‚ùå Failed to get interview prep', 'error');
            }
        }

        async function loadApplications() {
            const applicationsList = document.getElementById('applicationsList');
            applicationsList.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading applications...</span></div>';
            
            try {
                const response = await fetch(`${API_BASE}/applications/`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayApplications(data.applications || []);
                }
            } catch (error) {
                console.error('Applications loading error:', error);
                applicationsList.innerHTML = '<div style="color: #f44336; text-align: center; padding: 40px;">‚ùå Failed to load applications</div>';
            }
        }

        function displayApplications(applications) {
            const applicationsList = document.getElementById('applicationsList');
            
            if (applications.length === 0) {
                applicationsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.8);">
                        <h3>No applications yet</h3>
                        <p>Start applying to jobs to see them here!</p>
                        <button class="btn btn-ai" onclick="showAppTab('matches')" style="margin-top: 16px;">
                            üéØ Find Jobs
                        </button>
                    </div>
                `;
                return;
            }
            
            applicationsList.innerHTML = applications.map(app => `
                <div class="application-card">
                    <div>
                        <h4>${app.job.title}</h4>
                        <p style="color: rgba(255, 255, 255, 0.8); margin: 4px 0;">
                            ${app.job.company?.name || 'Company'}
                        </p>
                        <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                            Applied: ${new Date(app.applied_at).toLocaleDateString()}
                        </p>
                        ${app.match_score ? `<p style="color: #4CAF50; font-size: 0.9rem;">üéØ Match: ${app.match_score.toFixed(1)}%</p>` : ''}
                    </div>
                    <div style="text-align: right;">
                        <span class="status-badge status-${app.status}">${app.status}</span>
                        ${app.status === 'shortlisted' || app.status === 'accepted' ? `
                            <button class="btn btn-ai" onclick="getInterviewPrep(${app.job.id})" style="margin-top: 8px; font-size: 0.8rem; padding: 6px 12px;">
                                üìù Interview Prep
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        function logout() {
            localStorage.removeItem('authToken');
            authToken = null;
            currentUser = null;
            window.location.reload();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('uploadModal');
            if (event.target === modal) {
                closeUploadModal();
            }
        }
    </script>
</body>
</html>