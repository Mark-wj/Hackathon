<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employer Dashboard - Job Matching Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background-color: #2c3e50; 
            color: white; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .role-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            background-color: #2c3e50;
            color: white;
        }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
        .stat-card h3 { color: #7f8c8d; font-size: 14px; margin-bottom: 10px; }
        .stat-card .number { font-size: 32px; font-weight: bold; color: #2c3e50; }
        .section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .tab-container { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ecf0f1; }
        .tab { padding: 10px 20px; cursor: pointer; border-bottom: 3px solid transparent; border: none; background: none; }
        .tab.active { color: #3498db; border-bottom-color: #3498db; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .job-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 4px; }
        .job-card h4 { margin-bottom: 10px; color: #2c3e50; }
        .job-meta { display: flex; gap: 15px; margin: 8px 0; font-size: 14px; color: #7f8c8d; }
        .job-actions { display: flex; gap: 10px; margin-top: 10px; }
        .application-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .applicant-info h4 { margin-bottom: 5px; color: #2c3e50; }
        .applicant-info p { margin: 2px 0; font-size: 14px; color: #7f8c8d; }
        .application-actions { display: flex; flex-direction: column; gap: 10px; align-items: flex-end; }
        button { background-color: #3498db; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background-color: #2980b9; }
        .btn-success { background-color: #27ae60; }
        .btn-success:hover { background-color: #219a52; }
        .btn-danger { background-color: #e74c3c; }
        .btn-danger:hover { background-color: #c0392b; }
        .btn-warning { background-color: #f39c12; }
        .btn-warning:hover { background-color: #e67e22; }
        .btn-logout { background-color: #e74c3c; }
        .btn-logout:hover { background-color: #c0392b; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .status-pending { background-color: #f39c12; color: white; }
        .status-reviewing { background-color: #3498db; color: white; }
        .status-shortlisted { background-color: #27ae60; color: white; }
        .status-rejected { background-color: #e74c3c; color: white; }
        .status-accepted { background-color: #27ae60; color: white; }
        .status-active { color: #27ae60; font-weight: bold; }
        .status-inactive { color: #e74c3c; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 5% auto; padding: 20px; width: 80%; max-width: 600px; border-radius: 8px; max-height: 80vh; overflow-y: auto; }
        .close { float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: #e74c3c; }
        .message { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .empty-state { text-align: center; padding: 40px; color: #7f8c8d; }
        .empty-state h3 { margin-bottom: 10px; }
        .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .quick-action { padding: 15px; border: 1px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .quick-action:hover { background-color: #f8f9fa; border-color: #3498db; }
        .match-score { font-weight: bold; color: #27ae60; }
        .salary-range { color: #3498db; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>Employer Dashboard</h1>
                <p>Manage your jobs and find great candidates</p>
            </div>
            <div class="user-info">
                <span class="role-badge">Employer</span>
                <span id="employerName">Loading...</span>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>

        <div id="message"></div>

        <!-- Statistics Dashboard -->
        <div class="dashboard-grid">
            <div class="stat-card">
                <h3>Total Jobs Posted</h3>
                <div class="number" id="totalJobs">0</div>
            </div>
            <div class="stat-card">
                <h3>Active Jobs</h3>
                <div class="number" id="activeJobs">0</div>
            </div>
            <div class="stat-card">
                <h3>Total Applications</h3>
                <div class="number" id="totalApplications">0</div>
            </div>
            <div class="stat-card">
                <h3>Pending Review</h3>
                <div class="number" id="pendingApplications">0</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="quick-action" onclick="showCreateJobModal()">
                <h4>üìù Post New Job</h4>
                <p>Create a new job listing</p>
            </div>
            <div class="quick-action" onclick="showTab('applications')">
                <h4>üìã Review Applications</h4>
                <p>Check pending applications</p>
            </div>
            <div class="quick-action" onclick="showTab('analytics')">
                <h4>üìä View Analytics</h4>
                <p>See hiring performance</p>
            </div>
            <div class="quick-action" onclick="showTab('company')">
                <h4>üè¢ Company Profile</h4>
                <p>Update company information</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="section">
            <div class="tab-container">
                <button class="tab active" onclick="showTab('jobs')">My Jobs</button>
                <button class="tab" onclick="showTab('applications')">Applications</button>
                <button class="tab" onclick="showTab('company')">Company Profile</button>
                <button class="tab" onclick="showTab('analytics')">Analytics</button>
            </div>

            <!-- Jobs Tab -->
            <div id="jobsTab" class="tab-content active">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>My Job Listings</h2>
                    <button class="btn-success" onclick="showCreateJobModal()">+ Post New Job</button>
                </div>
                <div id="jobsList">
                    <p>Loading jobs...</p>
                </div>
            </div>

            <!-- Applications Tab -->
            <div id="applicationsTab" class="tab-content">
                <h2>Job Applications</h2>
                <div class="form-group">
                    <label>Filter by Job:</label>
                    <select id="jobFilter" onchange="loadApplications()">
                        <option value="">Select a job...</option>
                    </select>
                </div>
                <div id="applicationsList">
                    <p>Select a job to view applications</p>
                </div>
            </div>

            <!-- Company Tab -->
            <div id="companyTab" class="tab-content">
                <h2>Company Profile</h2>
                <form id="companyForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Company Name:</label>
                            <input type="text" id="companyName" required>
                        </div>
                        <div class="form-group">
                            <label>Industry:</label>
                            <input type="text" id="companyIndustry">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Company Description:</label>
                        <textarea id="companyDescription" rows="4"></textarea>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Company Size:</label>
                            <select id="companySize">
                                <option value="">Select company size...</option>
                                <option value="1-10">1-10 employees</option>
                                <option value="11-50">11-50 employees</option>
                                <option value="51-200">51-200 employees</option>
                                <option value="201-500">201-500 employees</option>
                                <option value="500+">500+ employees</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Location:</label>
                            <input type="text" id="companyLocation">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Company Website:</label>
                        <input type="url" id="companyWebsite">
                    </div>
                    <button type="submit">Update Company Profile</button>
                </form>
            </div>

            <!-- Analytics Tab -->
            <div id="analyticsTab" class="tab-content">
                <h2>Hiring Analytics</h2>
                <div id="analyticsContent">
                    <p>Loading analytics...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Job Modal -->
    <div id="createJobModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Post New Job</h2>
            <form id="createJobForm">
                <div class="form-group">
                    <label>Job Title:</label>
                    <input type="text" id="jobTitle" required>
                </div>
                <div class="form-group">
                    <label>Job Description:</label>
                    <textarea id="jobDescription" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Requirements:</label>
                    <textarea id="jobRequirements" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Required Skills (comma separated):</label>
                    <input type="text" id="jobSkills" placeholder="e.g., Python, JavaScript, SQL">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Experience Level:</label>
                        <select id="experienceLevel">
                            <option value="entry">Entry Level</option>
                            <option value="mid">Mid Level</option>
                            <option value="senior">Senior Level</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Job Type:</label>
                        <select id="jobType">
                            <option value="full_time">Full Time</option>
                            <option value="part_time">Part Time</option>
                            <option value="contract">Contract</option>
                            <option value="internship">Internship</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Location:</label>
                    <input type="text" id="jobLocation">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isRemote"> Remote Position
                    </label>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Minimum Salary:</label>
                        <input type="number" id="salaryMin" placeholder="e.g., 50000">
                    </div>
                    <div class="form-group">
                        <label>Maximum Salary:</label>
                        <input type="number" id="salaryMax" placeholder="e.g., 80000">
                    </div>
                </div>
                <button type="submit">Post Job</button>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let authToken = localStorage.getItem('authToken');
        let currentUser = null;
        let allJobs = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('createJobForm').addEventListener('submit', handleCreateJob);
            document.getElementById('companyForm').addEventListener('submit', handleCompanyUpdate);
        }

        async function checkAuth() {
            if (!authToken) {
                window.location.href = '/';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.user;
                    
                    // Check if user should be on this dashboard
                    if (currentUser.role === 'job_seeker') {
                        window.location.href = '/';
                        return;
                    } else if (currentUser.role === 'admin') {
                        window.location.href = '/admin';
                        return;
                    }
                    
                    document.getElementById('employerName').textContent = 
                        `${currentUser.first_name || ''} ${currentUser.last_name || ''}`.trim() || currentUser.email;
                    
                    loadDashboard();
                } else {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                window.location.href = '/';
            }
        }

        function logout() {
            localStorage.removeItem('authToken');
            window.location.href = '/';
        }

        async function loadDashboard() {
            await Promise.all([
                loadDashboardStats(),
                loadJobs(),
                loadJobsForFilter()
            ]);
        }

        async function loadDashboardStats() {
            try {
                const response = await fetch(`${API_BASE}/dashboard/stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const stats = data.stats;
                    
                    document.getElementById('totalJobs').textContent = stats.total_jobs || 0;
                    document.getElementById('activeJobs').textContent = stats.active_jobs || 0;
                    document.getElementById('totalApplications').textContent = stats.total_applications || 0;
                    document.getElementById('pendingApplications').textContent = stats.pending_applications || 0;
                }
            } catch (error) {
                console.error('Dashboard stats error:', error);
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'applications') {
                loadJobsForFilter();
            } else if (tabName === 'company') {
                loadCompanyProfile();
            } else if (tabName === 'analytics') {
                loadAnalytics();
            }
        }

        async function loadJobs() {
            try {
                const response = await fetch(`${API_BASE}/employer/jobs`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    allJobs = data.jobs || [];
                    displayJobs(allJobs);
                }
            } catch (error) {
                console.error('Load jobs error:', error);
                document.getElementById('jobsList').innerHTML = '<p>Error loading jobs</p>';
            }
        }

        function displayJobs(jobs) {
            const jobsList = document.getElementById('jobsList');
            
            if (jobs.length === 0) {
                jobsList.innerHTML = `
                    <div class="empty-state">
                        <h3>No jobs posted yet</h3>
                        <p>Start by posting your first job to attract candidates</p>
                        <button class="btn-success" onclick="showCreateJobModal()" style="margin-top: 15px;">Post Your First Job</button>
                    </div>
                `;
                return;
            }
            
            jobsList.innerHTML = jobs.map(job => `
                <div class="job-card">
                    <h4>${job.title}</h4>
                    <div class="job-meta">
                        <span>üìç ${job.location} ${job.is_remote ? '(Remote)' : ''}</span>
                        <span>üíº ${job.job_type}</span>
                        <span>üìä ${job.experience_level}</span>
                        <span>üìù ${job.application_count || 0} applications</span>
                    </div>
                    <p><strong>Status:</strong> <span class="status-${job.is_active ? 'active' : 'inactive'}">${job.is_active ? 'Active' : 'Inactive'}</span></p>
                    <p><strong>Posted:</strong> ${new Date(job.created_at).toLocaleDateString()}</p>
                    ${job.salary_min && job.salary_max ? `<p class="salary-range">üí∞ ${job.salary_min.toLocaleString()} - ${job.salary_max.toLocaleString()}</p>` : ''}
                    <div class="job-actions">
                        <button onclick="viewJobApplications(${job.id})" ${job.application_count > 0 ? '' : 'disabled'}>
                            View Applications (${job.application_count || 0})
                        </button>
                        <button onclick="editJob(${job.id})">Edit Job</button>
                        <button class="${job.is_active ? 'btn-warning' : 'btn-success'}" onclick="toggleJobStatus(${job.id}, ${job.is_active})">
                            ${job.is_active ? 'Deactivate' : 'Activate'}
                        </button>
                        <button class="btn-danger" onclick="deleteJob(${job.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function showCreateJobModal() {
            document.getElementById('createJobModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('createJobModal').style.display = 'none';
            document.getElementById('createJobForm').reset();
        }

        async function handleCreateJob(event) {
            event.preventDefault();
            
            const skills = document.getElementById('jobSkills').value.split(',').map(s => s.trim()).filter(s => s);
            
            const jobData = {
                title: document.getElementById('jobTitle').value,
                description: document.getElementById('jobDescription').value,
                requirements: document.getElementById('jobRequirements').value,
                skills_required: skills,
                experience_level: document.getElementById('experienceLevel').value,
                job_type: document.getElementById('jobType').value,
                location: document.getElementById('jobLocation').value,
                is_remote: document.getElementById('isRemote').checked,
                salary_min: parseInt(document.getElementById('salaryMin').value) || null,
                salary_max: parseInt(document.getElementById('salaryMax').value) || null
            };
            
            try {
                const response = await fetch(`${API_BASE}/jobs/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jobData)
                });
                
                if (response.ok) {
                    showMessage('Job posted successfully!', 'success');
                    closeModal();
                    loadJobs();
                    loadDashboardStats();
                } else {
                    const data = await response.json();
                    showMessage(data.error || 'Failed to post job', 'error');
                }
            } catch (error) {
                console.error('Create job error:', error);
                showMessage('Error posting job. Please try again.', 'error');
            }
        }

        async function toggleJobStatus(jobId, currentStatus) {
            try {
                const response = await fetch(`${API_BASE}/jobs/${jobId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ is_active: !currentStatus })
                });
                
                if (response.ok) {
                    showMessage('Job status updated successfully!', 'success');
                    loadJobs();
                    loadDashboardStats();
                } else {
                    showMessage('Failed to update job status', 'error');
                }
            } catch (error) {
                console.error('Job status update error:', error);
                showMessage('Update failed. Please try again.', 'error');
            }
        }

        async function deleteJob(jobId) {
            if (!confirm('Are you sure you want to delete this job? This action cannot be undone.')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/jobs/${jobId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    showMessage('Job deleted successfully!', 'success');
                    loadJobs();
                    loadDashboardStats();
                } else {
                    showMessage('Failed to delete job', 'error');
                }
            } catch (error) {
                console.error('Delete job error:', error);
                showMessage('Delete failed. Please try again.', 'error');
            }
        }

        function loadJobsForFilter() {
            const select = document.getElementById('jobFilter');
            select.innerHTML = '<option value="">Select a job...</option>' + 
                allJobs.map(job => `<option value="${job.id}">${job.title} (${job.application_count || 0} applications)</option>`).join('');
        }

        async function loadApplications() {
            const jobId = document.getElementById('jobFilter').value;
            if (!jobId) {
                document.getElementById('applicationsList').innerHTML = '<p>Select a job to view applications</p>';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/employer/jobs/${jobId}/applications`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayApplications(data.applications || []);
                }
            } catch (error) {
                console.error('Load applications error:', error);
                document.getElementById('applicationsList').innerHTML = '<p>Error loading applications</p>';
            }
        }

        function displayApplications(applications) {
            const appsList = document.getElementById('applicationsList');
            
            if (applications.length === 0) {
                appsList.innerHTML = `
                    <div class="empty-state">
                        <h3>No applications yet</h3>
                        <p>Applications will appear here when candidates apply to this job</p>
                    </div>
                `;
                return;
            }
            
            appsList.innerHTML = applications.map(app => `
                <div class="application-card">
                    <div class="applicant-info">
                        <h4>${app.applicant?.first_name || ''} ${app.applicant?.last_name || ''}</h4>
                        <p>üìß ${app.applicant?.email || 'N/A'}</p>
                        <p>üìÖ Applied: ${new Date(app.applied_at).toLocaleDateString()}</p>
                        ${app.match_score ? `<p class="match-score">üéØ Match Score: ${app.match_score.toFixed(1)}%</p>` : ''}
                    </div>
                    <div class="application-actions">
                        <span class="status-badge status-${app.status}">${app.status}</span>
                        <select onchange="updateApplicationStatus(${app.id}, this.value)" style="width: auto; margin: 10px 0;">
                            <option value="">Change status...</option>
                            <option value="reviewing">Reviewing</option>
                            <option value="shortlisted">Shortlisted</option>
                            <option value="rejected">Rejected</option>
                            <option value="accepted">Accepted</option>
                        </select>
                        <button onclick="viewApplicantProfile(${app.applicant?.id})">View Profile</button>
                    </div>
                </div>
            `).join('');
        }

        async function updateApplicationStatus(applicationId, newStatus) {
            if (!newStatus) return;
            
            try {
                const response = await fetch(`${API_BASE}/employer/applications/${applicationId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                });
                
                if (response.ok) {
                    showMessage('Application status updated successfully!', 'success');
                    loadApplications();
                    loadDashboardStats();
                } else {
                    showMessage('Failed to update application status', 'error');
                }
            } catch (error) {
                console.error('Update application status error:', error);
                showMessage('Update failed. Please try again.', 'error');
            }
        }

        async function loadCompanyProfile() {
            try {
                const response = await fetch(`${API_BASE}/employer/company`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const company = await response.json();
                    document.getElementById('companyName').value = company.name || '';
                    document.getElementById('companyDescription').value = company.description || '';
                    document.getElementById('companyIndustry').value = company.industry || '';
                    document.getElementById('companySize').value = company.size || '';
                    document.getElementById('companyLocation').value = company.location || '';
                    document.getElementById('companyWebsite').value = company.website || '';
                }
            } catch (error) {
                console.error('Load company error:', error);
            }
        }

        async function handleCompanyUpdate(event) {
            event.preventDefault();
            
            const companyData = {
                name: document.getElementById('companyName').value,
                description: document.getElementById('companyDescription').value,
                industry: document.getElementById('companyIndustry').value,
                size: document.getElementById('companySize').value,
                location: document.getElementById('companyLocation').value,
                website: document.getElementById('companyWebsite').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/employer/company`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(companyData)
                });
                
                if (response.ok) {
                    showMessage('Company profile updated successfully!', 'success');
                } else {
                    showMessage('Failed to update company profile', 'error');
                }
            } catch (error) {
                console.error('Company update error:', error);
                showMessage('Update failed. Please try again.', 'error');
            }
        }

        async function loadAnalytics() {
            try {
                const response = await fetch(`${API_BASE}/employer/analytics`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayAnalytics(data);
                } else {
                    document.getElementById('analyticsContent').innerHTML = '<p>Error loading analytics</p>';
                }
            } catch (error) {
                console.error('Load analytics error:', error);
                document.getElementById('analyticsContent').innerHTML = '<p>Error loading analytics</p>';
            }
        }

        function displayAnalytics(data) {
            const analyticsContent = document.getElementById('analyticsContent');
            
            analyticsContent.innerHTML = `
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Average Match Score</h3>
                        <div class="number">${data.average_match_score || 0}%</div>
                    </div>
                    <div class="stat-card">
                        <h3>Applications This Month</h3>
                        <div class="number">${data.applications_this_month || 0}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Hire Rate</h3>
                        <div class="number">${data.hire_rate || 0}%</div>
                    </div>
                    <div class="stat-card">
                        <h3>Time to Hire</h3>
                        <div class="number">${data.avg_time_to_hire || 0} days</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Application Status Breakdown</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                        ${Object.entries(data.status_breakdown || {}).map(([status, count]) => `
                            <div class="stat-card">
                                <h4>${status.charAt(0).toUpperCase() + status.slice(1)}</h4>
                                <div class="number" style="font-size: 24px;">${count}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Top Required Skills</h3>
                    <div style="margin-top: 15px;">
                        ${(data.top_skills || []).map(skill => `
                            <div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #ecf0f1;">
                                <span>${skill.skill}</span>
                                <span class="match-score">${skill.count} jobs</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Job Performance Summary</h3>
                    <div style="margin-top: 15px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h4>Most Popular Job Types</h4>
                                ${(data.popular_job_types || []).map(type => `
                                    <div style="display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #ecf0f1;">
                                        <span>${type.job_type}</span>
                                        <span class="match-score">${type.count} jobs</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div>
                                <h4>Application Trends</h4>
                                <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; text-align: center;">
                                    <p><strong>Peak Application Day:</strong> ${data.peak_application_day || 'Monday'}</p>
                                    <p><strong>Average Response Time:</strong> ${data.avg_response_time || 2} days</p>
                                    <p><strong>Success Rate:</strong> ${data.success_rate || 12}%</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function viewJobApplications(jobId) {
            showTab('applications');
            document.getElementById('jobFilter').value = jobId;
            loadApplications();
        }

        function editJob(jobId) {
            // Find the job in allJobs array
            const job = allJobs.find(j => j.id === jobId);
            if (!job) {
                showMessage('Job not found', 'error');
                return;
            }
            
            // Populate the modal with job data
            document.getElementById('jobTitle').value = job.title;
            document.getElementById('jobDescription').value = job.description;
            document.getElementById('jobRequirements').value = job.requirements || '';
            document.getElementById('jobSkills').value = (job.skills_required || []).join(', ');
            document.getElementById('experienceLevel').value = job.experience_level;
            document.getElementById('jobType').value = job.job_type;
            document.getElementById('jobLocation').value = job.location;
            document.getElementById('isRemote').checked = job.is_remote;
            document.getElementById('salaryMin').value = job.salary_min || '';
            document.getElementById('salaryMax').value = job.salary_max || '';
            
            // Change form submission to update instead of create
            const form = document.getElementById('createJobForm');
            form.onsubmit = (e) => handleUpdateJob(e, jobId);
            
            // Change modal title and button text
            document.querySelector('#createJobModal h2').textContent = 'Edit Job';
            document.querySelector('#createJobForm button[type="submit"]').textContent = 'Update Job';
            
            // Show modal
            document.getElementById('createJobModal').style.display = 'block';
        }

        async function handleUpdateJob(event, jobId) {
            event.preventDefault();
            
            const skills = document.getElementById('jobSkills').value.split(',').map(s => s.trim()).filter(s => s);
            
            const jobData = {
                title: document.getElementById('jobTitle').value,
                description: document.getElementById('jobDescription').value,
                requirements: document.getElementById('jobRequirements').value,
                skills_required: skills,
                experience_level: document.getElementById('experienceLevel').value,
                job_type: document.getElementById('jobType').value,
                location: document.getElementById('jobLocation').value,
                is_remote: document.getElementById('isRemote').checked,
                salary_min: parseInt(document.getElementById('salaryMin').value) || null,
                salary_max: parseInt(document.getElementById('salaryMax').value) || null
            };
            
            try {
                const response = await fetch(`${API_BASE}/jobs/${jobId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jobData)
                });
                
                if (response.ok) {
                    showMessage('Job updated successfully!', 'success');
                    closeModal();
                    loadJobs();
                    loadDashboardStats();
                } else {
                    const data = await response.json();
                    showMessage(data.error || 'Failed to update job', 'error');
                }
            } catch (error) {
                console.error('Update job error:', error);
                showMessage('Error updating job. Please try again.', 'error');
            }
        }

        function viewApplicantProfile(applicantId) {
            // Create a modal or new page to show applicant profile
            // For now, just show a message
            showMessage('Applicant profile viewing feature - opening in new window', 'success');
            
            // In a real implementation, you might open a new window or modal
            // window.open(`/applicant/${applicantId}`, '_blank');
        }

        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('createJobModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Reset modal when closing
        function closeModal() {
            document.getElementById('createJobModal').style.display = 'none';
            document.getElementById('createJobForm').reset();
            
            // Reset form submission handler
            document.getElementById('createJobForm').onsubmit = handleCreateJob;
            
            // Reset modal title and button text
            document.querySelector('#createJobModal h2').textContent = 'Post New Job';
            document.querySelector('#createJobForm button[type="submit"]').textContent = 'Post Job';
        }

        // Auto-refresh dashboard stats every 60 seconds
        setInterval(() => {
            loadDashboardStats();
        }, 60000);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + N for new job
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                showCreateJobModal();
            }
            
            // Escape to close modal
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Show notification count in title
        function updateTitleWithNotifications() {
            const pendingCount = document.getElementById('pendingApplications').textContent;
            if (pendingCount && pendingCount !== '0') {
                document.title = `(${pendingCount}) Employer Dashboard - Job Matching Platform`;
            } else {
                document.title = 'Employer Dashboard - Job Matching Platform';
            }
        }

        // Call this after loading dashboard stats
        setInterval(updateTitleWithNotifications, 5000);
    </script>
</body>
</html>
                <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employer Dashboard - Job Matching Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background-color: #2c3e50; 
            color: white; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .role-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            background-color: #2c3e50;
            color: white;
        }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
        .stat-card h3 { color: #7f8c8d; font-size: 14px; margin-bottom: 10px; }
        .stat-card .number { font-size: 32px; font-weight: bold; color: #2c3e50; }
        .section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .tab-container { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ecf0f1; }
        .tab { padding: 10px 20px; cursor: pointer; border-bottom: 3px solid transparent; border: none; background: none; }
        .tab.active { color: #3498db; border-bottom-color: #3498db; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .job-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 4px; }
        .job-card h4 { margin-bottom: 10px; color: #2c3e50; }
        .job-meta { display: flex; gap: 15px; margin: 8px 0; font-size: 14px; color: #7f8c8d; }
        .job-actions { display: flex; gap: 10px; margin-top: 10px; }
        .application-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .applicant-info h4 { margin-bottom: 5px; color: #2c3e50; }
        .applicant-info p { margin: 2px 0; font-size: 14px; color: #7f8c8d; }
        .application-actions { display: flex; flex-direction: column; gap: 10px; align-items: flex-end; }
        button { background-color: #3498db; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background-color: #2980b9; }
        .btn-success { background-color: #27ae60; }
        .btn-success:hover { background-color: #219a52; }
        .btn-danger { background-color: #e74c3c; }
        .btn-danger:hover { background-color: #c0392b; }
        .btn-warning { background-color: #f39c12; }
        .btn-warning:hover { background-color: #e67e22; }
        .btn-logout { background-color: #e74c3c; }
        .btn-logout:hover { background-color: #c0392b; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .status-pending { background-color: #f39c12; color: white; }
        .status-reviewing { background-color: #3498db; color: white; }
        .status-shortlisted { background-color: #27ae60; color: white; }
        .status-rejected { background-color: #e74c3c; color: white; }
        .status-accepted { background-color: #27ae60; color: white; }
        .status-active { color: #27ae60; font-weight: bold; }
        .status-inactive { color: #e74c3c; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 5% auto; padding: 20px; width: 80%; max-width: 600px; border-radius: 8px; max-height: 80vh; overflow-y: auto; }
        .close { float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: #e74c3c; }
        .message { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .empty-state { text-align: center; padding: 40px; color: #7f8c8d; }
        .empty-state h3 { margin-bottom: 10px; }
        .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .quick-action { padding: 15px; border: 1px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .quick-action:hover { background-color: #f8f9fa; border-color: #3498db; }
        .match-score { font-weight: bold; color: #27ae60; }
        .salary-range { color: #3498db; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>Employer Dashboard</h1>
                <p>Manage your jobs and find great candidates</p>
            </div>
            <div class="user-info">
                <span class="role-badge">Employer</span>
                <span id="employerName">Loading...</span>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>

        <div id="message"></div>

        <!-- Statistics Dashboard -->
        <div class="dashboard-grid">
            <div class="stat-card">
                <h3>Total Jobs Posted</h3>
                <div class="number" id="totalJobs">0</div>
            </div>
            <div class="stat-card">
                <h3>Active Jobs</h3>
                <div class="number" id="activeJobs">0</div>
            </div>
            <div class="stat-card">
                <h3>Total Applications</h3>
                <div class="number" id="totalApplications">0</div>
            </div>
            <div class="stat-card">
                <h3>Pending Review</h3>
                <div class="number" id="pendingApplications">0</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="quick-action" onclick="showCreateJobModal()">
                <h4>üìù Post New Job</h4>
                <p>Create a new job listing</p>
            </div>
            <div class="quick-action" onclick="showTab('applications')">
                <h4>üìã Review Applications</h4>
                <p>Check pending applications</p>
            </div>
            <div class="quick-action" onclick="showTab('analytics')">
                <h4>üìä View Analytics</h4>
                <p>See hiring performance</p>
            </div>
            <div class="quick-action" onclick="showTab('company')">
                <h4>üè¢ Company Profile</h4>
                <p>Update company information</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="section">
            <div class="tab-container">
                <button class="tab active" onclick="showTab('jobs')">My Jobs</button>
                <button class="tab" onclick="showTab('applications')">Applications</button>
                <button class="tab" onclick="showTab('company')">Company Profile</button>
                <button class="tab" onclick="showTab('analytics')">Analytics</button>
            </div>

            <!-- Jobs Tab -->
            <div id="jobsTab" class="tab-content active">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>My Job Listings</h2>
                    <button class="btn-success" onclick="showCreateJobModal()">+ Post New Job</button>
                </div>
                <div id="jobsList">
                    <p>Loading jobs...</p>
                </div>
            </div>

            <!-- Applications Tab -->
            <div id="applicationsTab" class="tab-content">
                <h2>Job Applications</h2>
                <div class="form-group">
                    <label>Filter by Job:</label>
                    <select id="jobFilter" onchange="loadApplications()">
                        <option value="">Select a job...</option>
                    </select>
                </div>
                <div id="applicationsList">
                    <p>Select a job to view applications</p>
                </div>
            </div>

            <!-- Company Tab -->
            <div id="companyTab" class="tab-content">
                <h2>Company Profile</h2>
                <form id="companyForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Company Name:</label>
                            <input type="text" id="companyName" required>
                        </div>
                        <div class="form-group">
                            <label>Industry:</label>
                            <input type="text" id="companyIndustry">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Company Description:</label>
                        <textarea id="companyDescription" rows="4"></textarea>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Company Size:</label>
                            <select id="companySize">
                                <option value="">Select company size...</option>
                                <option value="1-10">1-10 employees</option>
                                <option value="11-50">11-50 employees</option>
                                <option value="51-200">51-200 employees</option>
                                <option value="201-500">201-500 employees</option>
                                <option value="500+">500+ employees</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Location:</label>
                            <input type="text" id="companyLocation">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Company Website:</label>
                        <input type="url" id="companyWebsite">
                    </div>
                    <button type="submit">Update Company Profile</button>
                </form>
            </div>

            <!-- Analytics Tab -->
            <div id="analyticsTab" class="tab-content">
                <h2>Hiring Analytics</h2>
                <div id="analyticsContent">
                    <p>Loading analytics...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Job Modal -->
    <div id="createJobModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Post New Job</h2>
            <form id="createJobForm">
                <div class="form-group">
                    <label>Job Title:</label>
                    <input type="text" id="jobTitle" required>
                </div>
                <div class="form-group">
                    <label>Job Description:</label>
                    <textarea id="jobDescription" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Requirements:</label>
                    <textarea id="jobRequirements" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Required Skills (comma separated):</label>
                    <input type="text" id="jobSkills" placeholder="e.g., Python, JavaScript, SQL">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Experience Level:</label>
                        <select id="experienceLevel">
                            <option value="entry">Entry Level</option>
                            <option value="mid">Mid Level</option>
                            <option value="senior">Senior Level</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Job Type:</label>
                        <select id="jobType">
                            <option value="full_time">Full Time</option>
                            <option value="part_time">Part Time</option>
                            <option value="contract">Contract</option>
                            <option value="internship">Internship</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Location:</label>
                    <input type="text" id="jobLocation">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isRemote"> Remote Position
                    </label>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Minimum Salary:</label>
                        <input type="number" id="salaryMin" placeholder="e.g., 50000">
                    </div>
                    <div class="form-group">
                        <label>Maximum Salary:</label>
                        <input type="number" id="salaryMax" placeholder="e.g., 80000">
                    </div>
                </div>
                <button type="submit">Post Job</button>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let authToken = localStorage.getItem('authToken');
        let currentUser = null;
        let allJobs = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('createJobForm').addEventListener('submit', handleCreateJob);
            document.getElementById('companyForm').addEventListener('submit', handleCompanyUpdate);
        }

        async function checkAuth() {
            if (!authToken) {
                window.location.href = '/';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/employer/company`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(companyData)
                });
                
                if (response.ok) {
                    showMessage('Company profile updated successfully!', 'success');
                } else {
                    showMessage('Failed to update company profile', 'error');
                }
            } catch (error) {
                console.error('Company update error:', error);
                showMessage('Update failed. Please try again.', 'error');
            }
        }

        async function loadAnalytics() {
            try {
                const response = await fetch(`${API_BASE}/employer/analytics`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayAnalytics(data);
                } else {
                    document.getElementById('analyticsContent').innerHTML = '<p>Error loading analytics</p>';
                }
            } catch (error) {
                console.error('Load analytics error:', error);
                document.getElementById('analyticsContent').innerHTML = '<p>Error loading analytics</p>';
            }
        }

        function displayAnalytics(data) {
            const analyticsContent = document.getElementById('analyticsContent');
            
            analyticsContent.innerHTML = `
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Average Match Score</h3>
                        <div class="number">${data.average_match_score || 0}%</div>
                    </div>
                    <div class="stat-card">
                        <h3>Applications This Month</h3>
                        <div class="number">${data.applications_this_month || 0}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Hire Rate</h3>
                        <div class="number">${data.hire_rate || 0}%</div>
                    </div>
                    <div class="stat-card">
                        <h3>Time to Hire</h3>
                        <div class="number">${data.avg_time_to_hire || 0} days</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Application Status Breakdown</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                        ${Object.entries(data.status_breakdown || {}).map(([status, count]) => `
                            <div class="stat-card">
                                <h4>${status.charAt(0).toUpperCase() + status.slice(1)}</h4>
                                <div class="number" style="font-size: 24px;">${count}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Top Required Skills</h3>
                    <div style="margin-top: 15px;">
                        ${(data.top_skills || []).map(skill => `
                            <div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #ecf0f1;">
                                <span>${skill.skill}</span>
                                <span class="match-score">${skill.count} jobs</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function viewJobApplications(jobId) {
            showTab('applications');
            document.getElementById('jobFilter').value = jobId;
            loadApplications();
        }

        function editJob(jobId) {
            // For now, just show a message - you can implement job editing later
            showMessage('Job editing feature coming soon!', 'success');
        }

        function viewApplicantProfile(applicantId) {
            // For now, just show a message - you can implement profile viewing later
            showMessage('Applicant profile viewing feature coming soon!', 'success');
        }

        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('createJobModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html> 